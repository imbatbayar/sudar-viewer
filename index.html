<!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bodisadva ‚Äî Sudra Reader</title>

  <style>
    :root{
      --bg: #0b0c0f;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --line: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --radius: 18px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }

    html, body{
      height:100%;
      margin:0;
      background: radial-gradient(900px 500px at 50% 0%, rgba(255,255,255,.06), transparent 60%), var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *{ box-sizing:border-box; }

    /* ===== Layout ===== */
    .app{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .shell{
      width: min(980px, 100%);
      height: min(88vh, 860px);
      position:relative;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(0,0,0,.25);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* ===== Topbar ===== */
    .topbar{
      position:absolute;
      left:14px; right:14px; top:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.35);
      border:1px solid var(--line);
      backdrop-filter: blur(8px);
      z-index: 10;
    }

    .brand{
      display:flex;
      gap:10px;
      align-items:center;
      min-width:0;
    }
    .brandIcon{
      width:28px; height:28px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: var(--panel);
      border:1px solid var(--line);
      flex:0 0 auto;
    }
    .brandText{ min-width:0; line-height:1.1; }
    .brandTitle{
      font-weight:800;
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandSub{
      font-size:12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-top:3px;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      padding:8px 10px;
      border-radius: 14px;
      font-weight:750;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      line-height:1;
    }
    .btn:disabled{ opacity:.35; cursor:not-allowed; }

    .counter{
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: var(--panel2);
      color: var(--muted);
      font-size:12px;
      min-width:72px;
      text-align:center;
    }

    /* "–ì–∞—Ä–∞—Ö" */
    .closeBtn{
      padding:8px 12px;
    }

    /* ===== Viewer ===== */
    .viewer{
      position:absolute;
      inset:0;
      padding: 76px 16px 54px 16px; /* topbar + footer space */
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .paper{
      width:100%;
      height:100%;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.22);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    img.page{
      max-width: 100%;
      max-height: 100%;
      width:auto;
      height:auto;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(255,255,255,.02);
      box-shadow: 0 10px 30px rgba(0,0,0,.45);
      user-select:none;
      -webkit-user-drag:none;
      transform: translateZ(0);
    }

    /* ===== Footer ===== */
    .footer{
      position:absolute;
      left:14px; right:14px; bottom:24px; /* ‚¨Ö –±–∞–≥–∞ –∑—ç—Ä—ç–≥ –¥—ç—ç—à */
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      color: var(--muted2);
      font-size:12px;
      z-index:10;
      pointer-events:none;
    }
    .footer b{ color: var(--text); font-weight:850; }

    /* ===== Rotate overlay (mobile portrait) ===== */
    .rotateOverlay{
      display:none;
      position:absolute;
      inset:0;
      z-index:20;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(8px);
      padding:24px;
      text-align:center;
    }
    .rotateCard{
      width:min(420px, 100%);
      padding:16px 16px 14px 16px;
      border-radius: 18px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.55);
      box-shadow: var(--shadow);
    }
    .rotateIcon{
      font-size:34px;
      margin-bottom:10px;
    }
    .rotateTitle{
      font-weight:900;
      font-size:16px;
      margin-bottom:6px;
    }
    .rotateSub{
      color: var(--muted);
      font-size:13px;
      line-height:1.35;
    }

    /* ===== Responsive: mobile ===== */
    @media (max-width: 900px){
      .app{ padding:0; }
      .shell{
        width:100%;
        height:100dvh;
        border-radius:0;
      }
      .viewer{ padding: 74px 10px 52px 10px; }
      .topbar{
        left:10px; right:10px; top:10px;
        padding:10px 10px;
      }
      .brandSub{ display:none; }
      .counter{ min-width:auto; }
      .footer{ left:10px; right:10px; bottom:20px; }
      img.page{ border-radius:10px; }
    }

    /* Portrait “Ø–µ–¥: ‚Äú—É—Ç—Å–∞–∞ —ç—Ä–≥“Ø“Ø–ª‚Äù */
    @media (max-width: 900px) and (orientation: portrait){
      .rotateOverlay{ display:flex; }
    }
  </style>
</head>

<body>
  <!-- HTML -->
  <div class="app">
    <div class="shell" id="shell">
      <div class="topbar">
        <div class="brand">
          <div class="brandIcon">üìú</div>
          <div class="brandText">
            <div class="brandTitle">–°—É–¥–∞—Ä —É–Ω—à–∏–≥—á</div>
            <div class="brandSub">–•—ç–≤—Ç—ç—ç–≥—ç—ç—Ä —ç—Ä–≥“Ø“Ø–ª–∂ –±“Ø—Ç–Ω—ç—ç—Ä –Ω—å —É–Ω—à–∞–∞—Ä–∞–π</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="prev">‚¨Ü ”®–º–Ω”©—Ö</button>
          <button class="btn" id="next">‚¨á –î–∞—Ä–∞–∞—Ö</button>
          <div class="counter" id="counter">1 / 1</div>
          <button class="btn closeBtn" id="close" title="–ë—É—Ü–∞—Ö">–ì–∞—Ä–∞—Ö</button>
        </div>
      </div>

      <div class="viewer">
        <div class="paper">
          <img class="page" id="pageImg" alt="Sudra page" />
        </div>
      </div>

      <div class="footer">
        <span>Developed by <b>Bodisadva</b></span>
      </div>

      <div class="rotateOverlay" id="rotateOverlay">
        <div class="rotateCard">
          <div class="rotateIcon">üì±‚Üª</div>
          <div class="rotateTitle">–£—Ç—Å–∞–∞ —ç—Ä–≥“Ø“Ø–ª—ç—ç—Ä—ç–π</div>
          <div class="rotateSub">
            –°—É–¥–∞—Ä –±“Ø—Ç–Ω—ç—ç—Ä—ç—ç —Ö–∞—Ä–∞–≥–¥–∞—Ö—ã–Ω —Ç—É–ª–¥ —É—Ç—Å–∞–∞ —Ö—ç–≤—Ç—ç—ç (landscape) –±–∞–π—Ä–ª–∞–ª–¥ —ç—Ä–≥“Ø“Ø–ª–∂ —É–Ω—à–∞–∞—Ä–∞–π.
            <br><br>
            –•—ç—Ä–≤—ç—ç —ç—Ä–≥—ç—Ö–≥“Ø–π –±–∞–π–≤–∞–ª ‚ÄúAuto-rotate / Screen rotation‚Äù —Ç“Ø–≥–∂—ç—ç–≥ —Ç–∞–π–ª–∞–∞—Ä–∞–π.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    const PAGES = ["158.jpg","159.jpg","160.jpg","161.jpg","162.jpg"];
    const RETURN_URL = "https://sites.google.com/view/bodisadva/home-mantra";

    const pageImg = document.getElementById("pageImg");
    const counter = document.getElementById("counter");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const closeBtn = document.getElementById("close");
    const shell = document.getElementById("shell");

    let i = 0;
    let lock = false;

    const cache = new Map();
    function preload(src){
      if (cache.has(src)) return cache.get(src);
      const img = new Image();
      const p = new Promise((res, rej)=>{
        img.onload = () => res(true);
        img.onerror = () => rej(false);
      });
      img.src = src;
      cache.set(src, p);
      return p;
    }

    function ui(){
      counter.textContent = `${i+1} / ${PAGES.length}`;
      prevBtn.disabled = (i === 0) || lock;
      nextBtn.disabled = (i === PAGES.length - 1) || lock;
    }

    async function show(idx){
      if (idx < 0 || idx >= PAGES.length) return;
      lock = true;
      ui();

      const src = PAGES[idx];
      try { await preload(src); } catch(e) {}

      pageImg.style.transition = "opacity 180ms ease";
      pageImg.style.opacity = "0";

      setTimeout(()=>{
        pageImg.src = src;

        pageImg.onload = () => {
          pageImg.style.opacity = "1";
          lock = false;
          ui();
        };

        // fallback (–∑–∞—Ä–∏–º browser onload trigger —Ö–∏–π—Ö–≥“Ø–π “Ø–µ–¥)
        setTimeout(()=>{
          if (lock){
            pageImg.style.opacity = "1";
            lock = false;
            ui();
          }
        }, 650);
      }, 180);
    }

    function go(delta){
      if (lock) return;
      const ni = i + delta;
      if (ni < 0 || ni >= PAGES.length) return;
      i = ni;
      show(i);
    }

    prevBtn.addEventListener("click", ()=>go(-1));
    nextBtn.addEventListener("click", ()=>go(1));

    closeBtn.addEventListener("click", ()=>{
      try{
        if (window.top !== window.self){
          window.top.location.href = RETURN_URL;
          return;
        }
      }catch(e){}
      window.location.href = RETURN_URL;
    });

    // Wheel / trackpad
    let accum = 0;
    let timer = null;
    shell.addEventListener("wheel", (e)=>{
      e.preventDefault();
      if (lock) return;

      accum += e.deltaY;
      clearTimeout(timer);
      timer = setTimeout(()=>accum=0, 120);

      const TH = 140;
      if (accum > TH){ accum = 0; go(1); }
      if (accum < -TH){ accum = 0; go(-1); }
    }, {passive:false});

    // Swipe
    let y0 = null;
    shell.addEventListener("touchstart", (e)=>{
      y0 = e.touches[0].clientY;
    }, {passive:true});

    shell.addEventListener("touchend", (e)=>{
      if (y0 === null || lock) return;
      const y1 = e.changedTouches[0].clientY;
      const dy = y1 - y0;
      y0 = null;

      const TH = 42;
      if (dy > TH) go(-1);
      else if (dy < -TH) go(1);
    }, {passive:true});

    // Init
    (async ()=>{
      await preload(PAGES[0]).catch(()=>{});
      show(0);
    })();
  </script>
</body>
</html>
